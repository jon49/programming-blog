<html lang="en">
<head>

  
  <meta charset="utf-8">
  <title>Calculation Efficiency</title>
  <meta name="description" content="Calculation Efficiency">
  <meta name="author" content="Jon Nyman">

  
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="http://localhost:1313/css/fonts.css">
  
  
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
  

    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">

  <link rel="stylesheet" href="http://localhost:1313/css/custom.css">

  
  
  <link rel="stylesheet" href="http://localhost:1313/highlight/styles/default.css">
  
  <script src="http://localhost:1313/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>


<div class="header pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="desktop pure-menu pure-menu-horizontal nav-menu">
            
            <a href="/" class="site-title pure-menu-heading">Hamsters Byte</a>
            <ul class="pure-menu-list">
                
                <li class="pure-menu-item">
                    <a href="http://localhost:1313/about/" class="pure-menu-link">About</a>
                </li>
            </ul>
        </div>
        <div class="mobile pure-menu nav-menu">
            <a href="/" class="pure-menu-heading" id="toggle-home">Hamsters Byte</a>
            <a href="#" id="toggle-btn">&#9776;</a>
            <ul class="pure-menu-list" id="toggle-content" style="display:none;">
                
                
                <li class="pure-menu-item">
                    <a href="http://localhost:1313/about" class="pure-menu-link">About</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>


<div class="pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
	<div class="pure-u-11-12 pure-u-md-5-8">
        <div class="post">

            <div class="post-title">
                <p class="footnote">
                    <time class="">2012-03-28</time>
		            
                    
                    |
                    
                    
                    tags:<a href="http://localhost:1313/tags/excel">excel</a> <a href="http://localhost:1313/tags/formulas">formulas</a> <a href="http://localhost:1313/tags/array-formulas">array-formulas</a> <a href="http://localhost:1313/tags/efficiency">efficiency</a> 
                    

                    

                    
                </p>
                <h1>Calculation Efficiency</h1>
            </div>

            <div class="post-content">
                <p>Chandoo had some posts on speeding up Excel worksheets, one of the posts focuses on formulas and another he let the general readers make their suggestions. I made the suggestion that people use array formulas. But most of the other suggestions said not to use array formulas since they slow down your spreadsheet. Needless to say, I was a bit confused, I have seen quite the performance boost from using array formulas.</p>

<p>So I did a little test to see why I was getting differing results. The testing showed that both of us were right. Array formulas are faster for UDFs and regular formulas are better for built in Excel functions. There might be circumstances where the opposite is true. I used Excel DNA for my UDF function. It just shows, if you are trying to make things fast, isolate a workbook with a small data set and see which method is faster.</p>

<p>My only theory on why UDFs and internal Excel formulas perform differently is that Excel has continual access to the data while UDFs need to get a copy of the data. If anyone knows if this is true or not I would like to know, so please comment.</p>

<p>One suggestion that really helped me was putting the data in order based on which formula will be executed first, which is Left to Right, Top to Bottom. My time card workbook was noticeably faster after I made these changes.</p>

<p>So this is the code I used to test the speed of the formulas:</p>

<pre><code class="language-vbscript">Sub SpeedTest()
    Dim dTimer As Double
    Dim rFormula As Range, rArray As Range
    Dim lLast As Long, i As Long
    Application.Calculation = xlCalculationManual
    Application.Iteration = False
    lLast = Application.Rows.Count - 1
    Set rFormula = Range(&amp;#034D1:D&amp;#034 &amp; lLast)
    Set rArray = Range(&amp;#034C1:C&amp;#034 &amp; lLast)
    dTimer = Timer
    'For i = 0 To 99
        rArray.Calculate
    'Next i
    Debug.Print &amp;#034Array: &amp;#034 &amp; Timer - dTimer
    dTimer = Timer
    'For i = 0 To 99
        rFormula.Calculate
    'Next i
    Debug.Print &amp;#034Formula: &amp;#034 &amp; Timer - dTimer
End Sub
</code></pre>

<p>Internal Excel formulas tested were:</p>

<pre><code class="language-vbscript">=IF(MOD(A1,2)=0,A2,A1)
=IF(MOD(A1:A65535,2)=0,A2:A65536,A1:A65535)
</code></pre>

<p>The results of the above test showed a ratio of 7:10 formula over array formula.</p>

<p>The UDF formulas tested were:</p>

<pre><code class="language-vbscript">=SumDate($B$1:$B$65535,$A$1:$A$65535,A1,A1+5,TRUE)
=SumDate($B$1:$B$65535,$A$1:$A$65535,A1:$A$65535,A1:$A$65535+5,TRUE)
</code></pre>

<p>The results of the above test showed a ratio of 1465:1 formula over array formula. The resulting time is shown in the table below:</p>

<pre><code class="language-vbscript">Formula: 2610.16015625 seconds
Array: 1.78125 seconds
</code></pre>

            </div>
        </div>
	</div>
    <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>

<div class="footer pure-g">
    <div class="pure-u-1-24 pure-u-md-5-24"></div>
    <div class="pure-u-11-12 pure-u-md-5-8">
        <div class="pure-menu pure-menu-horizontal footer-content">
            <ul>
                <li class="pure-menu-heading" id="foot-name">Jon Nyman:</li>

                

                
                <li class="pure-menu-item">
                    <a href="https://github.com/jon49" class="pure-menu-link">GitHub</a>
                </li>
                

                
                <li class="pure-menu-item">
                    <a href="https://www.linkedin.com/in/eenyman" class="pure-menu-link">LinkedIn</a>
                </li>
                

                

                
                <li class="pure-menu-item">
                    <a href="https://twitter.com/NymanJon" class="pure-menu-link">Twitter</a>
                </li>
                

            </ul>
            <a href="#" class="pure-menu-heading pull-right" id="gototop-btn">↑↑</a>
        </div>
	  </div>
      <div class="pure-u-1-24 pure-u-md-1-6"></div>
</div>


<script src="http://localhost:1313/js/jquery.min.js" type="text/javascript"></script>
<script src="http://localhost:1313/js/jquery.timeago.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function(){
    $("time.timeago").timeago();
  })
  $("#toggle-btn").click(function(){
    $("#toggle-content").toggle();
    if($(this).html() === "☰") {
        $(this).html("X")
    } else {
        $(this).html("☰")
    }
  });
  $(window).resize(function(){
    if(window.innerWidth > 768) {
      $(".desktop").removeAttr("style");
    }
  });
</script>

<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>

